:root {
    --body-font-size: 1rem;
    --body-line-height: 1.75em;
    --body-indent-size: calc(var(--body-font-size) * 2);
    --body-hanging-punctuation: first allow-end;

    --h1-font-size: calc(var(--body-font-size) *  8 / 5);;
    --h1-line-height: 1.40625em;
    --h2-font-size: calc(var(--body-font-size) *  8 / 7);
    --h2-line-height: 1.53125em;
    --h3-font-size: calc(var(--body-font-size) *  8 / 10);
    --h3-line-height: 1.5625em;
    --caption-font-size: calc(var(--body-font-size) *  8 / 10);
    --caption-line-height: 1.5625em;
    --codeblock-font-size: calc(var(--body-font-size) *  8 / 9);
    --codeblock-line-height: 1.40625em;

    --vertical-rhythm-unit: calc(var(--body-font-size) * 1.75);
    --extra-leading: 0.25rem;

    // 720px/640px or 1280px width
    @media (min-width: 45em) and (min-height: 40rem), (min-width: 80em), print {
        --body-font-size: #{1rem * 16 / 15};
        --body-line-height: 1.875em;

        --h1-font-size: calc(var(--body-font-size) * 8 / 4);
        --h2-line-height: 1.640625em;
        --h3-line-height: 1.7578125em;
        --caption-line-height: 1.7578125em;
        --codeblock-line-height: 1.58203125em;

        --vertical-rhythm-unit: calc(var(--body-font-size) * 1.875);
    }

    @media print {
        --sidenote-width: calc(var(--body-font-size) * 12);
        --sidenote-gutter: calc(var(--body-font-size) * 2);
        --sidenote-font-size: calc(var(--body-font-size) *  8 / 12);
        --sidenote-line-height: 1.7578125em;
    }
}

:root {
    @media (orientation: portrait) {
        @media (min-width: 20em) { --body-width: 18em; } // 320px
        @media (min-width: 22.5em) { --body-width: 20em; } // 360px
        @media (min-width: 25em) { --body-width: 22em; } // 400px
        @media (min-width: 30em) { --body-width: 26em; } // 480px
        @media (min-width: 37.5em) { --body-width: 32em; } // 600px
    }

    @media (orientation: landscape) {
        @media (min-width: 30em) { --body-width: 24em; } // 480px
        @media (min-width: 35em) { --body-width: 28em; } // 560px
        @media (min-width: 40em) { --body-width: 32em; } // 640px
    }

    // 720px
    @media (min-width: 45em), print {
        --body-width: 36em;
    }
}

:lang(ja) {
    font-kerning: none;
}

:not(:lang(ja)) {
    font-kerning: auto;
}

html {
    -ms-text-size-adjust: 100%;
    -webkit-text-size-adjust: 100%;
}

body {
    font-family: $font-family-mincho-punc;
    font-weight: $font-weight-mincho-normal;
    font-feature-settings: $opentype-faetures-japanese;
    font-size: var(--body-font-size);
    line-height: var(--body-line-height);
    // word-wrap: break-word; // for IE 11
    overflow-wrap: break-word;
    hyphens: auto;

    background-color: $color-body-bg;
    color: $color-body-fg;
    margin: 0 auto;
    width: var(--body-width, auto);
    max-width: calc(100vw - 2rem);
}

main::after {
    content: "โฟ";
    display: block;
    text-align: center;
    margin-top: var(--vertical-rhythm-unit);
    color: $color-gray-400;
}

h1:lang(ja),
h2:lang(ja) {
    font-feature-settings: $opentype-faetures-japanese-proportional;
    font-kerning: auto;
}

h1 {
    font-family: $font-family-mincho;
    font-weight: $font-weight-mincho-normal;
    font-size: var(--h1-font-size);
    line-height: var(--h1-line-height);

    margin-top: 0;
    margin-bottom: 0;
}

h1 + footer {
    font-size: var(--caption-font-size);
    line-height: var(--caption-line-height);
    color: $color-mincho-muted;

    padding-top: var(--extra-leading);
    padding-bottom: var(--extra-leading);
}

h1 + :not(footer),
h1 + footer + * {
    margin-top: calc(var(--vertical-rhythm-unit) * 2);
}

h2 {
    font-family: $font-family-gothic;
    font-weight: $font-weight-gothic-bold;
    font-size: var(--h2-font-size);
    line-height: var(--h2-line-height);
    color: $color-gray-800;

    margin-top: var(--vertical-rhythm-unit);
    margin-bottom: var(--vertical-rhythm-unit);
}

h3 {
    font-family: $font-family-gothic-punc;
    font-weight: $font-weight-gothic-bold;
    font-size: var(--h3-font-size);
    line-height: var(--h3-line-height);
    color: $color-gray-900;

    padding-top: var(--extra-leading);
    padding-bottom: var(--extra-leading);
    margin-top: var(--vertical-rhythm-unit);
    margin-bottom: 0;
}

p,
ol,
ul,
dl {
    hanging-punctuation: var(--body-hanging-punctuation, none);
    margin-top: var(--vertical-rhythm-unit);
    margin-bottom: 0;
}

p + p {
    margin-top: 0;
    text-indent: var(--body-indent-size);
}

section + p:before {
    content: "ยง";
    display: block;
    margin-bottom: var(--vertical-rhythm-unit);
    text-align: center;
}

hr {
    border: 0;
    margin: 0;
}

ol,
ul,
dl {
    padding-left: var(--body-indent-size);
}

ol {
    counter-reset: ordered-list;
}

li {
    list-style-type: none;
    position: relative;
}

li::before {
    margin-right: 1em;
    position: absolute;
    right: 100%;
}

ol li {
    counter-increment: ordered-list;
}

ol li::before {
    content: counter(ordered-list);
}

ul li::before {
    content: "\2022";
}

dt {
    text-indent: calc(0px - var(--body-indent-size));
}

dd {
    margin-left: 0;
}

h3 + p,
h3 + ol,
h3 + ul,
h3 + dl {
    margin-top: 0;
}

ol p, ul p, dl p,
ol ol, ul ol, dl ol,
ol ul, ul ul, dl ul,
ol dl, ul dl, dl dl {
    margin-bottom: 0;
    margin-top: 0;
}

pre {
    font-family: $font-family-mono;
    font-size: var(--codeblock-font-size);
    line-height: var(--codeblock-line-height);

    padding-left: var(--body-indent-size);
    padding-top: var(--extra-leading);
    padding-bottom: var(--extra-leading);
    margin-top: var(--vertical-rhythm-unit);
    margin-bottom: var(--vertical-rhythm-unit);
    overflow: auto;
    overflow-wrap: normal; // for Safari
    -webkit-overflow-scrolling: touch;
}

blockquote {
    padding-left: var(--body-indent-size);
    margin: var(--vertical-rhythm-unit) 0;
    position: relative;

}

blockquote::after {
    content: "";
    position: absolute;
    left: 0;
    top: calc((var(--body-line-height) - 1em) / 2);
    bottom: calc((var(--body-line-height) - 1em) / 2);
    border-left: 2px solid $color-divider;
}

blockquote footer {
    text-align: right;
}

figure,
table {
    font-family: $font-family-gothic;
    font-weight: $font-weight-gothic-normal;
    font-size: var(--caption-font-size);
    line-height: var(--caption-line-height);
    margin: var(--vertical-rhythm-unit) auto;
}

figure {
    display: grid;
    grid-template-rows:
        calc(var(--caption-line-height) / 2)
        auto
        calc(var(--caption-line-height) / 2)
        auto;
    grid-template-areas:
        "."
        "figure"
        "."
        "caption";
}

figure > :not(figcaption) {
    grid-area: figure;
    justify-self: center;
}

figure img {
    box-shadow: 0 0 0 1px $color-divider;
}

figcaption {
    grid-area: caption;
}

table {
    border-collapse: collapse;
    display: block;
    overflow: auto;
    -webkit-overflow-scrolling: touch;
}

th,
td {
    padding: 0;
    white-space: nowrap;
}

th:not(:first-child),
td:not(:first-child) {
    padding-left: 2em;
}

th {
    font-family: $font-family-gothic-punc;
    font-weight: $font-weight-gothic-bold;
    text-align: left;
    color: $color-gray-900;
}

thead th,
thead td {
    padding-top: var(--extra-leading);
}

tbody th,
tbody td,
tfoot th,
tfoot td {
    position: relative;
    padding-top: var(--caption-line-height);
}

table > :last-child tr:last-child th,
table > :last-child tr:last-child td {
    padding-bottom: var(--caption-line-height);
}

tbody th::before,
tbody td::before,
tfoot th::before,
tfoot td::before,
table > :last-child tr:last-child th::after,
table > :last-child tr:last-child td::after {
    content: "";
    position: absolute;
    left: 0;
    right: 0;
    border-top: 1px solid $color-divider;
}

tbody th::before,
tbody td::before,
tfoot th::before,
tfoot td::before {
    top: calc(var(--caption-line-height) / 2);
}

tbody + tbody tr:first-child th::before,
tbody + tbody tr:first-child td::before,
tfoot tr:first-child th::before,
tfoot tr:first-child td::before {
    top: calc(var(--caption-line-height) / 2 - 1px);
    border-top-width: 3px;
}

table > :last-child tr:last-child th::after,
table > :last-child tr:last-child td::after {
    bottom: calc(var(--caption-line-height) / 2);
}

figcaption,
caption {
    padding-bottom: var(--extra-leading);
    color: $color-gothic-muted;
}

caption {
    caption-side: bottom;
    text-align: left;
}

a {
    color: $color-link-fg;
}

a[href^="#fn-"],
a[href^="#fnref-"] {
    font-family: $font-family-mono;
    font-weight: bold;
    line-height: 0;
    padding-left: 0.25em;
    padding-right: 0.25em;
    text-decoration: none;
}

mark,
[id^="fn-"]:target,
[id^="fnref-"]:target {
    background-color: $color-highlight-bg;
}

a:not([href]) {
    cursor: default;
}

b,
cite,
code,
dfn,
em,
i,
kbd,
samp,
small,
strong,
var {
    line-height: normal;
}

code,
samp,
kbd {
    color: $color-gray-900;
    font-family: $font-family-mono;
    // font-weight: $font-weight-mono-normal;
    margin-left: 0.1em;
    margin-right: 0.1em;
}

pre code,
pre samp,
pre kbd {
    line-height: inherit;
    margin-left: 0;
    margin-right: 0;
}

code *,
samp *,
kbd * {
    font-family: inherit !important;
}

cite:lang(ja),
dfn:lang(ja),
em:lang(ja),
i:lang(ja) {
    font-style: normal;
}

b,
strong,
dfn {
    color: $color-gray-900;
    font-family: $font-family-gothic-punc;
    font-weight: $font-weight-gothic-bold;
}

a code,
a samp,
a kbd,
a b,
a strong,
a dfn {
    color: inherit;
}

sub,
sup {
  font-size: 75%;
  line-height: 0;
  position: relative;
  vertical-align: baseline;
}

sup {
  top: -0.5em;
}

sub {
  bottom: -0.25em;
}

audio,
canvas,
iframe,
img,
svg,
video {
    vertical-align: middle;
}

img {
    max-width: 100%;
    height: auto;
}

svg {
    fill: currentColor;
}
